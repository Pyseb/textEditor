<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Document</title>
</head>

<body>
    <div id="menu">
        <select name="titre" id="titleBtn">
            <option value="">Selection de titre</option>
            <option value="h1">Gros</option>
            <option value="h3">moins gros</option>
        </select>
        <button id="gras" class="btn">G</button>
        <button id="italique" class="btn">I</button>
        <button id="under" class="btn">U</button>
        <button id="img" class="btn">IMG</button>
    </div>


    <div contenteditable spellcheck style="border:1px solid black; height: 500px; overflow-y:auto ;" id="zone">

    </div>
    <div id="addImg">
        <textarea id="addImgText" placeholder="Saisissez votre texte"></textarea>
        <!--<form action="envoi_img.php" method="POST" enctype="multipart/form-data">-->

        <input type="file" name="image[]" id="image" multiple="multiple">

        <p>L'image doit Ãªtre:</p>
        <input type="radio" id="radioLeft" name="align" value="left">
        <label for="left">A gauche</label>
        <input type="radio" id="radioRight" name="align" value="right">
        <label for="right">A droite</label>
        <input type="radio" id="radioCenter" name="align" value="center">
        <label for="center">Centrer</label>
        <div>
            <button id='send'>Envoi</button>
        </div>
        <!-- </form>-->
    </div>

</body>
<script>
    let v = 0
    let zone = document.getElementById("zone")

    let btn_gras = document.getElementById('gras');
    btn_gras.addEventListener('click', function() {
        mep('strong', this);

    })
    let btn_underline = document.getElementById('under');
    btn_underline.addEventListener('click', function() {
        mep('u', this);

    })
    let bnt_ital = document.getElementById('italique')
    bnt_ital.addEventListener('click', function() {
        mep('i', this);

    })
    let bnt_img = document.getElementById('img')
    bnt_img.addEventListener('click', toggleBtn)

    let btn_send = document.getElementById('send');
    btn_send.addEventListener('click', sendNewImg)


    // ajout d'image
    function sendNewImg() {
        const new_img_text = document.getElementById('addImgText')
        const new_div = document.createElement('div')
        new_div.classList = "newDivImg"
        const new_img = document.createElement('img')
        const new_text = document.createElement('p')

        new_text.innerText = new_img_text.value
        new_img.src = "3000.png"
        new_img.style.width = '150px';
        if (document.getElementById('radioLeft').checked) {
            new_text.style.order = "2"
            new_img.style.order = "1"
        } else if (document.getElementById('radioRight').checked) {
            new_text.style.order = "1"
            new_img.style.order = "2"
        }
        new_div.appendChild(new_img)
        new_div.appendChild(new_text)
        zone.appendChild(new_div)
        new_img_text.value = ""
        toggleBtn();

    }

    function toggleBtn() {
        document.getElementById('addImg').classList.toggle('active')
    }

    //fonction de mise en page du titre
    let listTitle = document.getElementById('titleBtn')
    listTitle.addEventListener('change', function() {

        if (zone.firstChild.nodeName == "H1" || zone.firstChild.nodeName == "H3") {

            zone.firstChild.remove()

        }


        title = document.createElement(listTitle.value)
        title.id = "title"
        title.ariaLabel = "titre"


        span = document.createElement("span")
        span.id = "spanTitle"
        span.style.color = "grey"
        span.style.width = "100 px"
            //span.contentEditable = false;
        span.innerText = "Saisir le titre"
        title.appendChild(span)


        zone.insertBefore(title, zone.firstChild)



        const spanClk = document.getElementById('spanTitle')
        spanClk.addEventListener('click', function() {
            console.log(document.getElementById('spanTitle').parentNode)
            document.getElementById('title').removeChild(document.getElementById("spanTitle"))
        })



    })





    //------------------------Fonction de mise en page-------------------------
    function mep(valeur, btn) {
        btn.classList.toggle('active')

        if (btn.classList.contains('active')) {
            console.log(btn.id)
            let selObj = window.getSelection();
            if (selObj.getRangeAt(0).startOffset != selObj.getRangeAt(0).endOffset) {
                //console.log(selObj.getRangeAt(0))
                repObj = `<${valeur}>${selObj}</${valeur}>`
                replaceSelectionWithHtml(repObj)

            } else {

                repObj = `<${valeur}> </${valeur}>`
                replaceSelectionWithHtml(repObj)
                zone.focus()

            }
        } else {
            let range = document.createRange();
            //range.collapse = true;
            range.setStartAfter(zone.firstChild)

            console.log(range)

            console.log(`pas ${btn.id}`)
                //zone.lastChild.focus()

        }

    }

    function replaceSelectionWithHtml(html) {
        var range;
        if (window.getSelection && window.getSelection().getRangeAt) {
            range = window.getSelection().getRangeAt(0);
            range.deleteContents();
            var div = document.createElement("div");
            div.innerHTML = html;
            var frag = document.createDocumentFragment(),
                child;
            while ((child = div.firstChild)) {
                frag.appendChild(child);

            }
            range.insertNode(frag);
        } else if (document.selection && document.selection.createRange) {
            range = document.selection.createRange();
            range.pasteHTML(html);
        }
    }
</script>

</html>